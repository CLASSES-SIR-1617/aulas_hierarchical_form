<!DOCTYPE html>
<html>
<head>
	<title>Euromilhões</title>
	<script type="text/javascript" src="jquery/jquery-3.1.1.js"></script>
	<style type="text/css">
		body {
			background-color: black;
			color:white;
			margin:0px;
		}

		#divtitle, #divinfo {
			background-color: lightgrey;
			color:navy;
		}

		ul.numbers, ul.stars {
			display: inline-block;
		}
		ul.numbers li {
			background-color: cyan;
		}
		ul.stars li {
			background-color: yellow;
		}

		ul.stars li, ul.numbers li {
			display: inline-block;
			width: 40px;
			color: black;
			border-radius : 10px;
			text-align: center;
			text-align: center;
			text-align: center;
		}


	</style>
</head>
<body>
<div id="divtitle">
	Euromilhões
</div>
<div id="divcontrol">
	<button id="bgen">Gerar Chave</button>
	<button id="bget1">Obter Chaves Rápidas</button>
	<button id="bget2">Obter Chaves Lentas</button>
	<button id="breset">Apagar Chaves</button>
</div>

<div id="divcontent">
	<div class="divkey">
	
		<ul class="numbers">
			<li>2</li>
			<li>4</li>
			<li>17</li>
			<li>33</li>
			<li>47</li>
		</ul>
		<ul class="stars">
			<li>5</li>
			<li>11</li>
		</ul>
	</div>
</div>

<div id="divinfo">
	&copy; Pedro Miguel Moreira | SIR1617
</div>
<script type="text/javascript">

	// $("div.divkey li").html("33");
	// botao gerar

	//$(".divkey ul li").click(function () {alert($(this).html())});

	//$(".divkey ul li").on("click",function () {alert($(this).html())});

	$("#divcontent").on( "click",".divkey ul li",function () {alert($(this).html())});


	$("#bget1").click(function () {
		$.ajax({
			url : "http://alunos.estg.ipvc.pt/~pmoreira/KEYSERVER/KeyServerJSON.php",
			//async : false,
			method : "get",
			dataType : "json",
			success : function (data) {
				$("#divcontent").append(key2HTML(data));
			}
		});
	});

/*
	$("#bget2").click(function () {
		$.ajax({
			url : "http://alunos.estg.ipvc.pt/~pmoreira/KEYSERVER2/KeyServerJSON.php",
			method : "get",
			dataType : "json",
			success : function (data) {
				$("#divcontent").append(key2HTML(data));
			}
		});
	})

*/
	$("#bget2").click(function () {
		$.getJSON("http://alunos.estg.ipvc.pt/~pmoreira/KEYSERVER2/KeyServerJSON.php", function (data) {
				$("#divcontent").append(key2HTML(data));
			});
	});

	//document.getElementById("bgen").onclick =  genKey;
	$("#bgen").click(genKey);	


	function genKey() {
		keyGenerator(key);
		divnewkey = key2HTML(key);

		//document.getElementById("divcontent").appendChild(divnewkey);
		$("#divcontent").append(divnewkey);
	}

	
	//document.getElementById("breset").onclick = function () {
	//	document.getElementById("divcontent").innerHTML = "";
	//}

	$("#breset").click(function () {$("#divcontent").empty();});


	key = {
		numbers : [11,4,5,6,7],
		stars : [5,6],
		log2console: function () {console.log(this)}
	} ;


	function keyGenerator(k) {

		// reset chave;
		k.numbers = [];
		k.stars = [];

		// preencher tombolas

		var allnumbers = [];

		for (var i=1; i<=50; i++) {
			allnumbers.push(i);
		}

		var allstars = [];
		for (var i=1; i<=11; i++) {
			allstars.push(i);
		}



		for(var n=0; n<5; n++) {
			var idx = Math.floor(Math.random()*allnumbers.length);
			var extracted = allnumbers.splice(idx,1);
			k.numbers.push(extracted[0]);
		}

		k.numbers.sort(compareNumber);

		for(var n=0; n<2; n++) {
			var idx = Math.floor(Math.random()*allstars.length);
			var extracted = allstars.splice(idx,1);
			k.stars.push(extracted[0]);
		}

		k.stars.sort(compareNumber);

		console.log(allnumbers);
		console.log(allstars);

		return k;
		
	}

	function compareNumber(a,b) {
		return a-b;
	}


	function key2HTML (k){
		//divkey = document.createElement("div");
		//divkey.setAttribute("class","divkey");

		divkey = $("<div/>").addClass("divkey");

		
		//listofnumbers = document.createElement("ul");
		//listofnumbers.setAttribute("class","numbers");

		listofnumbers = $("<ul/>").addClass("numbers");



		/*
		for (var i = 0; i < k.numbers.length; i++) {
			item = document.createElement("li");
			item.innerHTML = k.numbers[i];
			listofnumbers.appendChild(item);
			}
		*/


		k.numbers.forEach(function (element,index,array) {


			//var item = document.createElement("li");
			//item.innerHTML = element;
			//listofnumbers.appendChild(item);

			listofnumbers.append($("<li>").html(element));
		})

		//listofstars = document.createElement("ul");
		//listofstars.setAttribute("class","stars");

		listofstars = $("<ul/>").addClass("stars");

		for (var i = 0; i < k.stars.length; i++) {
			
			//item = document.createElement("li");
			//item.innerHTML = k.stars[i];
			//listofstars.appendChild(item);

			listofstars.append($("<li>").html(k.stars[i]));
		}

		//divkey.appendChild(listofnumbers);
		//divkey.appendChild(listofstars);

		divkey.append(listofnumbers).append(listofstars);
		
		return divkey;
	}


</script>
</body>
</html>






